#!/bin/bash

if [[ $(id -u) -ne 0 ]] ; then
    echo "Please run with sudo"
    exit 1
fi

run () {
    echo "$@"
    "$@" || exit 1
}

create_r1(){
 #setup namespace
 run ip netns add h1
 run ip netns add r1

 #setup veth peer
 run ip link add h1-veth1 type veth name r1-veth2
 run ip link set h1-veth1 netns h1
 run ip link set r1-veth2 netns r1

 #h1 configuration
 run ip netns exec h1 ip link set lo up
 run ip netns exec h1 ip addr add 10.0.0.1 dev h1-veth1
 run ip netns exec h1 link set h1-veth1 up
 #OSPFでルーティング予定だけど，無理だったら以下スタティック
:<< ‘ #COMMENTOUT’
run ip netns exec h1 ip -4 route add 10.1.0.1/24 via 10.0.0.2
run ip netns exec h1 ip -4 route add 10.2.0.1/24 via 10.0.0.2
run ip netns exec h1 ip -4 route add 10.3.0.1/24 via 10.0.0.2
 #COMMENTOUT

 #router1 configuration
 run ip netns exec r1 ip link set lo up
 run ip netns exec r1 ip link set r1-veth2 up
 run ip netns exec r1 ip addr add 10.0.0.2 dev r1-veth2

#ルーティングテーブル関係なのでOSPFするなら消していいかも
 #sysctl for router1
 ip netns exec router sysctl -w net.ipv4.ip_forward=1
}
